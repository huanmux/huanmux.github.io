import{c as P,r as o,s as b,j as e,X as H,R as Or,M as Ce,V as Gr,A as Br,u as Jr,a as Hr,b as ke,S as Wr,T as ge,L as Kr,F as hr,U as Yr,d as Xr,e as Zr,C as Qr,f as es,g as he,I as Ae,h as rs,B as ss,i as ts,k as as,l as Fe,m as os,n as ns,o as vr,p as ls}from"./main-CZZoxSPi.js";import{M as jr,V as cs,P as is,$ as ds}from"./bundler-v5uTwFHc.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=P("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=P("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=P("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=P("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=P("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=P("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=P("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=P("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=P("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=P("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=P("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=P("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),vs=Or.memo(({peer:f,isFocused:j,onToggleFocus:g})=>{const d=o.useRef(null);o.useEffect(()=>{const y=d.current;y&&(f.stream&&y.srcObject!==f.stream?(y.srcObject=f.stream,y.onloadedmetadata=()=>{y.play().catch(x=>console.warn("Autoplay blocked/pending:",x))}):f.stream||(y.srcObject=null))},[f.stream]);const R=f.stream&&f.stream.getVideoTracks().length>0&&!f.isVideoOff,E=f.volume>15;return e.jsxs("div",{className:`
                relative bg-gray-800 rounded-xl overflow-hidden border-2 transition-all duration-300
                ${E?"border-green-500 shadow-[0_0_15px_rgba(34,197,94,0.4)]":"border-transparent"} 
                ${j?"col-span-full row-span-full h-full":"aspect-video"}
            `,onDoubleClick:g,children:[e.jsx("video",{ref:d,autoPlay:!0,playsInline:!0,muted:f.peerId==="local",className:`w-full h-full bg-black object-cover absolute inset-0 z-10 ${R?"opacity-100":"opacity-0"}`}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 z-0",children:e.jsxs("div",{className:`relative transition-transform duration-150 ${E?"scale-110":"scale-100"}`,children:[e.jsx("img",{src:f.profile?.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${f.userId}`,className:"w-20 h-20 rounded-full shadow-2xl object-cover bg-gray-700 z-10 relative",alt:f.userId}),E&&e.jsx("div",{className:"absolute -inset-2 rounded-full border-4 border-green-500 opacity-50 animate-ping"})]})}),e.jsx("div",{className:"absolute bottom-3 left-3 right-3 flex justify-between items-center z-20",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-md px-2 py-1 rounded-lg flex items-center gap-2 text-white text-xs font-medium",children:[f.isMuted?e.jsx(jr,{size:12,className:"text-red-500"}):e.jsx(Ce,{size:12,className:"text-green-400"}),e.jsx("span",{className:"truncate max-w-[100px]",children:f.profile?.display_name||"Connecting..."})]})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 hover:opacity-100 transition-opacity z-20",children:e.jsx("button",{onClick:g,className:"p-1.5 bg-black/50 rounded-full text-white",children:j?e.jsx(wr,{size:16}):e.jsx(yr,{size:16})})})]})}),ps=({channelId:f,channelName:j,user:g,onDisconnect:d,isMinimized:N,onToggleMinimize:R})=>{const[E,y]=o.useState(null),[x,w]=o.useState({}),[_,A]=o.useState(null),[l,S]=o.useState({mic:!0,camera:!1,screen:!1}),[k,z]=o.useState(null),[Z,oe]=o.useState(!1),[Se,Q]=o.useState([]),X=o.useRef(null),ee=o.useRef({}),F=o.useRef(null),W=o.useRef(null),T=o.useRef(null),re=o.useRef(null);o.useEffect(()=>{ee.current=x},[x]);const M=(t,u)=>{const c=Math.random().toString(36).substr(2,9);Q(i=>[...i,{id:c,message:t,type:u}]),setTimeout(()=>Q(i=>i.filter(v=>v.id!==c)),4e3)};o.useEffect(()=>((async()=>{try{M("Accessing media devices...","info");const u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});A(u),F.current=u,Y("local",u);const c=new ds({config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]},debug:1});X.current=c,c.on("open",async i=>{console.log("My Peer ID:",i),y(i),M("Connected to signaling server","success"),await b.from("active_voice_sessions").upsert({channel_id:f,user_id:g.id,peer_id:i}),le(i,u)}),c.on("call",i=>{console.log("Incoming call from:",i.peer),i.answer(u),ce(i)}),c.on("error",i=>{if(console.error("PeerJS Error:",i),M(`Connection Error: ${i.type}`,"error"),i.type==="peer-unavailable"){const v=i.message.split(" ").pop();v&&se(v)}})}catch(u){console.error("Init Error:",u),M(`Failed to start: ${u.message}`,"error"),d()}})(),()=>ne()),[f]);const ne=async()=>{g&&await b.from("active_voice_sessions").delete().match({channel_id:f,user_id:g.id}),W.current?.unsubscribe(),X.current?.destroy(),F.current?.getTracks().forEach(t=>t.stop()),T.current&&T.current.close()},le=(t,u)=>{const c=b.channel(`vc:${f}`,{config:{presence:{key:t}}});W.current=c,c.on("presence",{event:"sync"},()=>{const i=c.presenceState();Object.values(i).flat().forEach(C=>{if(C.peerId!==t&&!ee.current[C.peerId]&&t>C.peerId){console.log("Initiating call to:",C.peerId);const B=X.current.call(C.peerId,u,{metadata:{userId:g.id,profile:g.user_metadata}});ce(B,C)}})}).on("presence",{event:"leave"},({leftPresences:i})=>{i.forEach(v=>se(v.peerId))}).on("broadcast",{event:"media_state"},({payload:i})=>{w(v=>({...v,[i.peerId]:{...v[i.peerId],isMuted:i.isMuted,isVideoOff:i.isVideoOff,isScreenSharing:i.isScreenSharing}}))}).subscribe(async i=>{i==="SUBSCRIBED"&&await c.track({peerId:t,userId:g.id,profile:g.user_metadata,mediaState:l})})},K=async t=>{!W.current||!E||await W.current.send({type:"broadcast",event:"media_state",payload:{peerId:E,isMuted:!t.mic,isVideoOff:!t.camera,isScreenSharing:t.screen}})},ce=(t,u)=>{const c=t.peer,i=t.metadata||u||{};Me(c,i),t.on("stream",v=>{console.log("Received stream from:",c),U(c,v),Y(c,v)}),t.on("close",()=>se(c)),t.on("error",()=>se(c))},Me=async(t,u)=>{let c=u.profile;const i=u.userId;if(!c&&i){const{data:v}=await b.from("profiles").select("*").eq("id",i).single();v&&(c=v)}w(v=>({...v,[t]:{peerId:t,userId:i||"unknown",profile:c||{display_name:"Unknown User",avatar_url:""},stream:void 0,volume:0,isMuted:!1,isVideoOff:!1}}))},U=(t,u)=>{w(c=>c[t]?{...c,[t]:{...c[t],stream:u}}:c)},se=t=>{w(u=>{const c={...u};return delete c[t],c})},ie=()=>{if(!_)return;const t=_.getAudioTracks()[0],u=!t.enabled;t.enabled=u;const c={...l,mic:u};S(c),K(c)},$e=async()=>{if(_)if(l.camera){_.getVideoTracks().forEach(c=>c.stop());const t=new MediaStream(_.getAudioTracks());A(t),F.current=t;const u={...l,camera:!1,screen:!1};S(u),K(u)}else try{const u=(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0],c=new MediaStream([..._.getAudioTracks(),u]);A(c),F.current=c,ve(u);const i={...l,camera:!0,screen:!1};S(i),K(i)}catch{M("Failed to access camera","error")}},te=async()=>{if(_)if(l.screen){_.getVideoTracks().forEach(c=>c.stop());const t=new MediaStream(_.getAudioTracks());A(t),F.current=t;const u={...l,screen:!1,camera:!1};S(u),K(u)}else try{const u=(await navigator.mediaDevices.getDisplayMedia({video:!0})).getVideoTracks()[0];u.onended=()=>{const v=F.current;if(v){const B=v.getAudioTracks(),L=new MediaStream(B);A(L),F.current=L}const C={...l,screen:!1,camera:!1};S(C),K(C)};const c=new MediaStream([..._.getAudioTracks(),u]);A(c),F.current=c,ve(u);const i={...l,screen:!0,camera:!1};S(i),K(i)}catch(t){console.error(t),M("Screen sharing cancelled","info")}},ve=t=>{Object.values(X.current?.connections||{}).forEach(u=>{u.forEach(c=>{const i=c.peerConnection.getSenders().find(v=>v.track?.kind==="video");i?i.replaceTrack(t):c.peerConnection.addTrack(t,_)})})},Y=(t,u)=>{T.current||(T.current=new AudioContext);try{const c=T.current.createMediaStreamSource(u),i=T.current.createAnalyser();i.fftSize=32,c.connect(i);const v=new Uint8Array(i.frequencyBinCount),C=()=>{if(ee.current[t]||t==="local"){i.getByteFrequencyData(v);const B=v.reduce((L,ae)=>L+ae)/v.length;t==="local"||w(L=>L[t]?{...L,[t]:{...L[t],volume:B}}:L),requestAnimationFrame(C)}};C()}catch{}},$=()=>{document.fullscreenElement?(document.exitFullscreen(),oe(!1)):(re.current?.requestFullscreen(),oe(!0))},I=[{peerId:"local",userId:g.id,stream:_||void 0,profile:{display_name:"You",avatar_url:g.user_metadata.avatar_url,username:g.user_metadata.username},isMuted:!l.mic,isVideoOff:!l.camera&&!l.screen,volume:0},...Object.values(x)];return N?e.jsxs("div",{className:"fixed bottom-20 right-4 w-64 bg-gray-900 border border-gray-700 rounded-xl shadow-2xl overflow-hidden z-[60] animate-in slide-in-from-bottom-5",children:[e.jsxs("div",{className:"bg-green-600 p-2 flex justify-between items-center text-white",children:[e.jsxs("span",{className:"font-bold text-xs flex items-center gap-2 truncate",children:[e.jsx(Be,{size:14})," ",j]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:R,children:e.jsx(yr,{size:14})}),e.jsx("button",{onClick:d,className:"hover:text-red-200",children:e.jsx(H,{size:14})})]})]}),e.jsx("div",{className:"p-2 grid grid-cols-3 gap-1 max-h-40 overflow-y-auto",children:I.map(t=>e.jsxs("div",{className:`aspect-square bg-gray-800 rounded relative overflow-hidden ${t.volume>20?"border border-green-500":""}`,children:[t.stream&&!t.isVideoOff?e.jsx("video",{ref:u=>{u&&t.stream&&(u.srcObject=t.stream)},autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}):e.jsx("img",{src:t.profile?.avatar_url,className:"w-full h-full object-cover opacity-50"}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 text-[8px] text-white bg-black/50 truncate px-1",children:t.profile?.display_name})]},t.peerId))})]}):e.jsxs("div",{ref:re,className:"fixed inset-0 z-50 bg-gray-900 text-white flex flex-col",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-6 bg-gray-800/50 backdrop-blur border-b border-gray-700 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(Be,{className:"text-green-500"})," ",j]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[I.length," Active"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-700 rounded-full",children:e.jsx(bs,{size:20})}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-700 rounded-full",children:e.jsx(wr,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 flex items-center justify-center",children:e.jsx("div",{className:`
                 grid gap-4 w-full max-w-7xl transition-all duration-500
                 ${k?"grid-cols-1 h-full":""}
                 ${!k&&I.length===1?"grid-cols-1 max-w-3xl":""}
                 ${!k&&I.length===2?"grid-cols-1 md:grid-cols-2":""}
                 ${!k&&I.length>2?"grid-cols-2 md:grid-cols-3 lg:grid-cols-4":""}
                 auto-rows-fr
             `,children:I.map(t=>k&&t.peerId!==k?null:e.jsx(vs,{peer:t,isFocused:k===t.peerId,onToggleFocus:()=>z(k?null:t.peerId)},t.peerId))})}),e.jsxs("div",{className:"h-24 bg-gray-800 flex items-center justify-center gap-6 shrink-0 pb-safe",children:[e.jsx("button",{onClick:ie,className:`p-4 rounded-full ${l.mic?"bg-gray-700 hover:bg-gray-600":"bg-red-500 text-white"}`,children:l.mic?e.jsx(Ce,{size:24}):e.jsx(jr,{size:24})}),e.jsx("button",{onClick:$e,className:`p-4 rounded-full ${l.camera?"bg-white text-black":"bg-gray-700 hover:bg-gray-600"}`,children:l.camera?e.jsx(Gr,{size:24}):e.jsx(cs,{size:24})}),e.jsx("button",{onClick:te,className:`p-4 rounded-full ${l.screen?"bg-green-500 text-white":"bg-gray-700 hover:bg-gray-600"}`,children:e.jsx(fs,{size:24})}),e.jsx("div",{className:"w-px h-10 bg-gray-700 mx-2"}),e.jsxs("button",{onClick:d,className:"bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-full font-bold flex items-center gap-2",children:[e.jsx(is,{size:20})," End"]})]}),e.jsx("div",{className:"fixed bottom-28 right-6 flex flex-col gap-2 z-[70] pointer-events-none",children:Se.map(t=>e.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg text-sm font-medium animate-in slide-in-from-right fade-in ${t.type==="error"?"bg-red-500":t.type==="success"?"bg-green-600":"bg-gray-700"}`,children:[t.type==="error"&&e.jsx(Br,{size:16}),t.message]},t.id))})]})},js=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ’€"],ze=f=>{if(!f)return!1;const j=new Date(f);return new Date().getTime()-j.getTime()<3e5},ys=f=>{if(!f)return null;const j=new Date(f),d=new Date().getTime()-j.getTime();if(d<3e5)return"Online";const N=Math.floor(d/1e3),R=Math.floor(N/(3600*24)),E=Math.floor(N%(3600*24)/3600),y=Math.floor(N%3600/60);let x=[];return R>0&&x.push(`${R}d`),E>0&&x.push(`${E}h`),y>0&&x.push(`${y}m`),x.length===0?"Just now":`Last seen ${x[0]} ago`},pr=f=>{const j=/(https?:\/\/[^\s]+)/g,g=f.match(j);return g?g[0]:null},ws=(f,j)=>{if(!f)return[];const g=new Map;for(const d of f){g.has(d.emoji)||g.set(d.emoji,{emoji:d.emoji,count:0,hasReacted:!1,senders:[]});const N=g.get(d.emoji);N.count++,N.senders.push(d.profiles.display_name),d.user_id===j&&(N.hasReacted=!0)}return Array.from(g.values()).sort((d,N)=>N.count-d.count)},Ge=({src:f,isOutgoing:j})=>{const g=o.useRef(null),[d,N]=o.useState(!1),[R,E]=o.useState(0),[y,x]=o.useState(0),w=j?"rgb(var(--color-text-on-primary))":"rgb(var(--color-accent))",_=j?"rgba(var(--color-text-on-primary), 0.3)":"rgb(var(--color-border))";o.useEffect(()=>{const l=g.current;if(!l)return;const S=()=>E(l.duration),k=()=>x(l.currentTime),z=()=>N(!l.paused),Z=()=>{N(!1),l.currentTime=0};return l.addEventListener("loadedmetadata",S),l.addEventListener("timeupdate",k),l.addEventListener("play",z),l.addEventListener("pause",z),l.addEventListener("ended",Z),()=>{l.removeEventListener("loadedmetadata",S),l.removeEventListener("timeupdate",k),l.removeEventListener("play",z),l.removeEventListener("pause",z),l.removeEventListener("ended",Z)}},[]);const A=l=>{l.preventDefault(),g.current&&(d?g.current.pause():g.current.play())};return e.jsxs("div",{className:"flex items-center space-x-2 w-full max-w-full mb-1",children:[e.jsx("audio",{ref:g,src:f,preload:"metadata",className:"hidden"}),e.jsx("button",{onClick:A,className:"flex-shrink-0 p-2 rounded-full transition-colors",style:{backgroundColor:j?"rgba(var(--color-text-on-primary), 0.15)":"rgb(var(--color-surface-hover))",color:w},children:d?e.jsx(os,{size:16,fill:w}):e.jsx(ns,{size:16,fill:w})}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:R||100,value:y,onChange:l=>{g.current&&(g.current.currentTime=parseFloat(l.target.value))},className:"w-full h-1 appearance-none rounded-full cursor-pointer",style:{background:`linear-gradient(to right, ${w} 0%, ${w} ${y/R*100||0}%, ${_} ${y/R*100||0}%, ${_} 100%)`}}),e.jsxs("span",{className:"text-[10px]",style:{color:w},children:[Math.floor(y/60),":",Math.floor(y%60).toString().padStart(2,"0")]})]})]})},Ns=f=>{const j=new Date(f),g=new Date,d=new Date;return d.setDate(g.getDate()-1),j.toDateString()===g.toDateString()?"Today":j.toDateString()===d.toDateString()?"Yesterday":j.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric",year:"numeric"})},Cs=({initialInviteCode:f,onInviteHandled:j,initialGazeboId:g})=>{const{user:d,profile:N}=Jr(),R=Hr(),[E,y]=o.useState([]),[x,w]=o.useState(null),[_,A]=o.useState([]),[l,S]=o.useState(null),[k,z]=o.useState([]),[Z,oe]=o.useState([]),[Se,Q]=o.useState([]),[X,ee]=o.useState(!0),[F,W]=o.useState(!1),T=o.useRef(null),[re,M]=o.useState("servers"),[ne,le]=o.useState(!0),[K,ce]=o.useState(!1),[Me,U]=o.useState(!1),[se,ie]=o.useState(!1),[$e,te]=o.useState(!1),[ve,Y]=o.useState(!1),[$,I]=o.useState(null),[t,u]=o.useState(null),[c,i]=o.useState(null),[v,C]=o.useState(null),[B,L]=o.useState(""),[ae,Ee]=o.useState(null),[de,Je]=o.useState(""),[q,ue]=o.useState(null),[V,pe]=o.useState(""),[Ie,De]=o.useState(!1),[Nr,He]=o.useState(0),[We,Ke]=o.useState(!1),[_r,Re]=o.useState(null),[Ye,Xe]=o.useState(!1),[Te,Ze]=o.useState(null),[xe,Qe]=o.useState(null),[er,rr]=o.useState(!1),[je,ye]=o.useState(null),[we,be]=o.useState(null),sr=o.useRef(null),tr=o.useRef(null),ar=o.useRef(null),Le=o.useRef([]);o.useRef(null),o.useRef(null);const me=x?.owner_id===d?.id,kr=Z.find(r=>r.user_id===d?.id)?.role||"member",O=me||kr==="admin",or=20,[zr,Ve]=o.useState(!1),[D,Ne]=o.useState("image"),[_e,Cr]=o.useState([]),[Sr,nr]=o.useState(!1),Mr=async()=>{if(!l)return;nr(!0);const{data:r}=await b.from("gazebo_messages").select("*, sender:profiles(*)").eq("channel_id",l.id).not("media_url","is",null).neq("media_url","").order("created_at",{ascending:!1});r&&Cr(r),nr(!1)},$r=(r,a)=>{if(r.length<=a)return r;const s=r.slice(0,Math.floor(a/2)),n=r.slice(-Math.floor(a/2));return`${s}...${n}`},lr=()=>["owner","admin","member"].map(r=>{const a=Z.filter(s=>s.role===r);return a.length===0?null:e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-xs font-bold text-[rgb(var(--color-text-secondary))] uppercase mb-2",children:[r==="owner"?"Owner":r==="admin"?"Admins":"Members"," â€” ",a.length]}),a.map(s=>e.jsxs("div",{className:"group flex items-center gap-2 p-2 rounded hover:bg-[rgb(var(--color-surface-hover))] cursor-pointer opacity-90 hover:opacity-100 relative",children:[e.jsxs("div",{className:"relative",onClick:()=>I(s.profiles),children:[e.jsx("img",{src:s.profiles.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.profiles.username}`,className:"w-8 h-8 rounded-full object-cover"}),ze(s.profiles.last_seen)&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-[rgb(var(--color-surface))] rounded-full"})]}),e.jsx("span",{className:"font-medium truncate flex-1",style:{color:r==="owner"?"#eab308":r==="admin"?"#3b82f6":"inherit"},onClick:()=>I(s.profiles),children:s.profiles.display_name}),r==="owner"&&e.jsx(xs,{size:14,className:"text-yellow-500"}),r==="admin"&&e.jsx(hs,{size:14,className:"text-blue-500"}),O&&s.user_id!==d?.id&&s.role!=="owner"&&e.jsxs("div",{className:"absolute right-2 hidden group-hover:flex bg-[rgb(var(--color-surface))] border border-[rgb(var(--color-border))] rounded shadow-lg z-20",children:[e.jsx("button",{title:"Kick",onClick:()=>Rr(s.user_id),className:"p-1 hover:text-red-500",children:e.jsx(ls,{size:14})}),me&&e.jsx("button",{title:"Toggle Admin",onClick:()=>Tr(s.user_id,s.role==="admin"?"member":"admin"),className:"p-1 hover:text-blue-500",children:e.jsx(gs,{size:14})})]})]},s.user_id))]},r)});o.useEffect(()=>{if(!d)return;(async()=>{const{data:a}=await b.from("gazebo_members").select("gazebo_id, gazebos(*)").eq("user_id",d.id);if(a){const s=a.map(n=>n.gazebos).filter(Boolean);if(y(s),f)ur(f).then(n=>{j&&j()});else if(g){const n=s.find(m=>m.id===g);n?(w(n),M("channels")):s.length>0&&window.innerWidth>768&&w(s[0])}else s.length>0&&!x&&window.innerWidth>768&&w(s[0])}})()},[d,f,g]),o.useEffect(()=>{if(!x){A([]),oe([]),S(null);return}const r=async()=>{const{data:s}=await b.from("gazebo_channels").select("*").eq("gazebo_id",x.id).order("created_at");if(A(s||[]),s&&s.length>0){const h=s.find(p=>p.type==="text")||s[0];(!l||l.gazebo_id!==x.id)&&S(h)}const{data:n}=await b.from("gazebo_members").select("user_id, role, profiles(*)").eq("gazebo_id",x.id),m=(n||[]).map(h=>({user_id:h.user_id,role:h.role,profiles:h.profiles}));oe(m)};r();const a=b.channel(`gazebo_updates:${x.id}`).on("postgres_changes",{event:"*",schema:"public",table:"gazebo_channels",filter:`gazebo_id=eq.${x.id}`},()=>r()).on("postgres_changes",{event:"*",schema:"public",table:"gazebo_members",filter:`gazebo_id=eq.${x.id}`},()=>r()).subscribe();return()=>{b.removeChannel(a)}},[x?.id]),o.useEffect(()=>{if(!l||l.type!=="text"){z([]);return}cr(!0);const r=b.channel(`ch:${l.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"gazebo_messages",filter:`channel_id=eq.${l.id}`},async a=>{const s=a.new,{data:n}=await b.from("profiles").select("*").eq("id",s.user_id).single();let m=null;if(s.reply_to_id){const{data:h}=await b.from("gazebo_messages").select("id, content, user_id, media_type").eq("id",s.reply_to_id).single();if(h){const{data:p}=await b.from("profiles").select("display_name").eq("id",h.user_id).single();m={...h,sender:p}}}z(h=>[...h,{...s,sender:n,reply_to:m}]),setTimeout(ir,100)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"gazebo_messages",filter:`channel_id=eq.${l.id}`},a=>{z(s=>s.map(n=>n.id===a.new.id?{...n,content:a.new.content}:n))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"gazebo_messages",filter:`channel_id=eq.${l.id}`},a=>{z(s=>s.filter(n=>n.id!==a.old.id))}).on("postgres_changes",{event:"*",schema:"public",table:"gazebo_message_reactions"},async a=>{if(a.eventType==="INSERT"){const s=a.new,{data:n}=await b.from("gazebo_message_reactions").select("*, profiles(*)").eq("id",s.id).single();n&&(z(m=>m.map(h=>h.id===s.message_id?{...h,reactions:[...h.reactions||[],n]}:h)),be(m=>m?.id===s.message_id?{...m,reactions:[...m.reactions||[],n]}:m))}else if(a.eventType==="DELETE"){const s=a.old;z(n=>n.map(m=>m.reactions?.some(h=>h.id===s.id)?{...m,reactions:m.reactions.filter(h=>h.id!==s.id)}:m)),be(n=>n?.reactions?.some(m=>m.id===s.id)?{...n,reactions:n.reactions.filter(m=>m.id!==s.id)}:n)}}).subscribe();return()=>{b.removeChannel(r)}},[l?.id]);const cr=async(r=!1)=>{if(!l||(r&&(z([]),ee(!0)),!X&&!r))return;W(!0);const a=r?0:k.length,s=a+or-1,{data:n,count:m}=await b.from("gazebo_messages").select(`
            *, 
            sender:profiles(*),
            reactions:gazebo_message_reactions(
                id, emoji, user_id, 
                profiles(id, display_name, username, avatar_url)
            )
          `,{count:"exact"}).eq("channel_id",l.id).order("created_at",{ascending:!1}).range(a,s);if(!n){W(!1);return}const h=n.map(G=>G.reply_to_id).filter(Boolean);let p={};if(h.length>0){const{data:G}=await b.from("gazebo_messages").select("id, content, user_id, media_type").in("id",h);if(G)for(let Pe of G){const{data:Ur}=await b.from("profiles").select("display_name").eq("id",Pe.user_id).single();p[Pe.id]={...Pe,sender:Ur}}}const J=n.map(G=>({...G,reply_to:G.reply_to_id?p[G.reply_to_id]:null})).reverse();r?(z(J),setTimeout(ir,50)):z(G=>[...J,...G]),n.length<or&&ee(!1),W(!1)},Er=()=>{if(T.current?.scrollTop===0&&!F&&X){const r=T.current.scrollHeight;cr().then(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight-r)})}},ir=()=>{sr.current?.scrollIntoView({behavior:"smooth"})},dr=async(r,a)=>{const s=r.target.files?.[0];if(!s)return;const n=await vr(s,"profiles");n&&n.url&&(a==="create"?Ze(n.url):a==="update"&&x&&xr({icon_url:n.url}))},ur=async r=>{if(!d||!r)return null;const{data:a}=await b.from("gazebo_invites").select("*, gazebos(*)").eq("invite_code",r).single();if(!a)return alert("Invalid invite code"),null;const s=a.gazebos,{data:n}=await b.from("profiles").select("*").eq("id",s.owner_id).single(),{count:m}=await b.from("gazebo_members").select("*",{count:"exact",head:!0}).eq("gazebo_id",s.id).eq("user_id",d.id);if(m)E.find(h=>h.id===s.id)||y(h=>[...h,s]),w(s),M("channels"),te(!1),U(!1);else{const{error:h}=await b.from("gazebo_members").insert({gazebo_id:s.id,user_id:d.id,role:"member"});if(!h)return await b.from("gazebo_invites").update({uses_count:a.uses_count+1}).eq("id",a.id),y(p=>[...p,s]),w(s),n&&u({gazebo:s,owner:n}),M("channels"),te(!1),U(!1),s}return s},Ir=async r=>{if(!r.trim()||!d)return;const{data:a}=await b.from("gazebos").insert({name:r.trim(),type:"group",owner_id:d.id,icon_url:Te||`https://ui-avatars.com/api/?name=${r}&background=random`}).select().single();if(a){await b.from("gazebo_members").insert({gazebo_id:a.id,user_id:d.id,role:"owner"});const{data:s}=await b.from("gazebo_channels").insert({gazebo_id:a.id,name:"general",type:"text"}).select().single();y(n=>[...n,a]),w(a),s&&S(s),ie(!1),U(!1),Ze(null)}},xr=async r=>{if(!x||!O)return;const{data:a}=await b.from("gazebos").update(r).eq("id",x.id).select().single();a&&(w(a),y(s=>s.map(n=>n.id===a.id?a:n)))},Dr=async()=>{!x||!me||!confirm("Delete this Gazebo? This cannot be undone.")||(await b.from("gazebos").delete().eq("id",x.id),y(r=>r.filter(a=>a.id!==x.id)),w(null),M("servers"))},Rr=async r=>{!x||!O||!confirm("Kick this user?")||await b.from("gazebo_members").delete().eq("gazebo_id",x.id).eq("user_id",r)},Tr=async(r,a)=>{!x||!me||await b.from("gazebo_members").update({role:a}).eq("gazebo_id",x.id).eq("user_id",r)},br=async r=>{if(r.preventDefault(),!l||!d||Ie||!de.trim()&&!q&&!V)return;De(!0),He(0);let a=de.trim(),s=V,n=null;if(!q&&!s&&a){const m=/(https?:\/\/[^\s]+)/g,h=a.match(m);if(h){const p=h[0];p.match(/\.(jpeg|jpg|gif|png|webp|mp4|webm|mp3|wav)$/i)&&(s=p,a===p&&(a=""))}}if(q){q.type.startsWith("audio/")&&(n="audio");const m=await vr(q,"gazebo-messages");if(!m){De(!1);return}s=m.url,n=n||m.type}else V&&(V.match(/\.(jpeg|jpg|gif|png|webp)$/i)?n="image":V.match(/\.(mp4|webm|mov|avi)$/i)?n="video":V.match(/\.(mp3|wav|ogg|m4a)$/i)?n="audio":n="document");await b.from("gazebo_messages").insert({channel_id:l.id,user_id:d.id,content:de.trim(),media_url:s,media_type:n||"text",reply_to_id:ae?.id}),Je(""),ue(null),pe(""),De(!1),He(0),Re(null),Ee(null)},Lr=async r=>{confirm("Delete message?")&&await b.from("gazebo_messages").delete().eq("id",r)},Vr=async()=>{!v||!B.trim()||(await b.from("gazebo_messages").update({content:B}).eq("id",v),C(null),L(""))},mr=async(r,a)=>{if(!d)return;const n=k.find(m=>m.id===r)?.reactions?.find(m=>m.user_id===d.id&&m.emoji===a);ye(null),n?await b.from("gazebo_message_reactions").delete().eq("id",n.id):await b.from("gazebo_message_reactions").insert({message_id:r,user_id:d.id,emoji:a})},qr=async r=>{await b.from("gazebo_message_reactions").delete().eq("id",r)},Pr=()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(r=>{const a=new MediaRecorder(r);ar.current=a,Le.current=[],a.ondataavailable=s=>Le.current.push(s.data),a.onstop=()=>{const s=new Blob(Le.current,{type:"audio/webm"}),n=new File([s],"voice.webm",{type:"audio/webm"});ue(n),Xe(!1),r.getTracks().forEach(m=>m.stop())},a.start(),Xe(!0)})},Ar=()=>{ar.current?.stop()},qe=async(r,a)=>{if(!(!x||!O)&&(r==="create"&&(await b.from("gazebo_channels").insert({gazebo_id:x.id,name:a.name,type:a.type}),Y(!1)),r==="update"&&c&&(await b.from("gazebo_channels").update({name:a}).eq("id",c),i(null)),r==="delete"&&a)){if(!confirm("Delete channel?"))return;await b.from("gazebo_channels").delete().eq("id",a),l?.id===a&&S(null)}},fr=async(r,a)=>{if(!(!x||!O)){if(r==="create"){const s=a||Math.random().toString(36).substring(2,10),{data:n}=await b.from("gazebo_invites").insert({gazebo_id:x.id,invite_code:s,created_by_user_id:d.id}).select().single();n&&Q(m=>[n,...m])}r==="delete"&&a&&(await b.from("gazebo_invites").delete().eq("id",a),Q(s=>s.filter(n=>n.id!==a)))}},gr=()=>{if(q){const r=URL.createObjectURL(q);return q.type.startsWith("image/")?e.jsx("img",{src:r,className:"max-h-20 rounded"}):q.type.startsWith("audio/")?e.jsx("div",{className:"w-64",children:e.jsx(Ge,{src:r,isOutgoing:!0})}):e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Fe,{size:16})," ",q.name]})}return V?V.match(/\.(jpeg|jpg|gif|png|webp)$/i)?e.jsx("img",{src:V,className:"max-h-20 rounded"}):e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{size:16})," ",V]}):null},fe=window.innerWidth<=768,Fr=r=>{if(r.clipboardData.files.length>0){const a=r.clipboardData.files[0];a.type.startsWith("image/")&&(ue(a),pe(""),r.preventDefault())}};return e.jsxs("div",{className:"flex h-full w-full bg-[rgb(var(--color-background))] overflow-hidden text-[rgb(var(--color-text))]",children:[e.jsxs("div",{className:`flex-shrink-0 bg-[rgb(var(--color-surface))] border-r border-[rgb(var(--color-border))] flex flex-col items-center py-3 space-y-2 z-30 ${fe&&re!=="servers"?"hidden":"flex"} w-18 md:w-20`,children:[E.map(r=>e.jsxs("button",{onClick:()=>{w(r),M("channels")},className:`group relative w-12 h-12 flex items-center justify-center rounded-3xl hover:rounded-xl transition-all duration-300 overflow-hidden ${x?.id===r.id?"rounded-xl bg-[rgb(var(--color-primary))]":"bg-[rgb(var(--color-surface-hover))]"}`,children:[r.icon_url?e.jsx("img",{src:r.icon_url,className:"w-full h-full object-cover"}):e.jsx("span",{className:"font-bold text-lg",children:r.name.substring(0,2).toUpperCase()}),x?.id===r.id&&e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-white rounded-r-full"})]},r.id)),e.jsx("button",{onClick:()=>U(!0),className:"w-12 h-12 rounded-3xl bg-[rgb(var(--color-surface-hover))] text-green-500 hover:bg-green-500 hover:text-white flex items-center justify-center transition-all duration-300 shadow-sm hover:shadow-md",children:e.jsx(ke,{size:24})})]}),e.jsxs("div",{className:`flex-shrink-0 w-60 bg-[rgb(var(--color-surface))] flex flex-col border-r border-[rgb(var(--color-border))] ${fe&&re!=="channels"?"hidden":"flex"} ${x?"":"hidden"}`,children:[e.jsxs("div",{className:"h-12 border-b border-[rgb(var(--color-border))] flex items-center justify-between px-4 font-bold shadow-sm hover:bg-[rgb(var(--color-surface-hover))] cursor-pointer transition relative",onClick:()=>O&&ce(!0),children:[e.jsx("span",{className:"truncate",children:x?.name}),O&&e.jsx(Ue,{size:16})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[fe&&e.jsxs("button",{onClick:()=>M("servers"),className:"flex items-center gap-2 text-sm text-[rgb(var(--color-text-secondary))] mb-4 px-2 py-2 hover:bg-[rgb(var(--color-surface-hover))] rounded w-full",children:[e.jsx(Ue,{className:"rotate-90",size:14})," Back to Servers"]}),e.jsxs("div",{className:"flex items-center justify-between px-2 pt-4 pb-1 text-xs font-bold text-[rgb(var(--color-text-secondary))] hover:text-[rgb(var(--color-text))] group",children:[e.jsx("span",{children:"TEXT CHANNELS"}),O&&e.jsx("button",{onClick:()=>Y(!0),children:e.jsx(ke,{size:14})})]}),_.filter(r=>r.type==="text").map(r=>e.jsxs("div",{className:`group flex items-center justify-between px-2 py-1 rounded cursor-pointer ${l?.id===r.id?"bg-[rgb(var(--color-surface-hover))] text-[rgb(var(--color-text))]":"text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-surface-hover))] hover:text-[rgb(var(--color-text))]"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 truncate flex-1",onClick:()=>{S(r),M("chat")},children:[e.jsx(Oe,{size:18,className:"text-[rgb(var(--color-text-secondary))]"}),c===r.id?e.jsx("input",{autoFocus:!0,defaultValue:r.name,onKeyDown:a=>{a.key==="Enter"&&qe("update",a.currentTarget.value)},onBlur:()=>i(null),className:"bg-transparent outline-none w-full"}):e.jsx("span",{children:r.name})]}),O&&e.jsxs("div",{className:"hidden group-hover:flex gap-1",children:[e.jsx(Wr,{size:14,onClick:()=>i(r.id)}),e.jsx(ge,{size:14,onClick:()=>qe("delete",r.id),className:"text-red-500"})]})]},r.id)),e.jsxs("div",{className:"flex items-center justify-between px-2 pt-4 pb-1 text-xs font-bold text-[rgb(var(--color-text-secondary))] group",children:[e.jsx("span",{children:"VOICE CHANNELS"}),O&&e.jsx("button",{onClick:()=>Y(!0),children:e.jsx(ke,{size:14})})]}),_.filter(r=>r.type==="voice").map(r=>e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer ${xe?.channelId===r.id?"bg-[rgb(var(--color-surface-hover))] text-green-500":"text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-surface-hover))]"}`,onClick:()=>Qe({channelId:r.id,name:r.name}),children:[e.jsx(Be,{size:18}),e.jsx("span",{children:r.name}),xe?.channelId===r.id&&e.jsx("div",{className:"flex -space-x-1 ml-auto",children:e.jsx("img",{src:d?.user_metadata.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${d?.user_metadata.username}`,className:"w-4 h-4 rounded-full border border-[rgb(var(--color-surface))]"})})]},r.id))]}),e.jsxs("div",{className:"p-2 bg-[rgb(var(--color-surface-hover))] flex items-center gap-2 border-t border-[rgb(var(--color-border))]",children:[e.jsx("img",{src:N?.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${N?.username}`,className:"w-8 h-8 rounded-full bg-gray-500 object-cover cursor-pointer",onClick:()=>{N&&I(N)}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-bold truncate",children:N?.display_name||"Loading..."}),e.jsxs("div",{className:"text-xs text-[rgb(var(--color-text-secondary))] truncate",children:["@",N?.username||"..."]})]}),e.jsx("button",{className:"p-1 hover:bg-[rgb(var(--color-surface))]",onClick:()=>w(null),children:e.jsx(Kr,{size:16})})]})]}),e.jsx("div",{className:`flex-1 flex flex-col min-w-0 bg-[rgb(var(--color-background))] ${fe&&re!=="chat"?"hidden":"flex"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-12 border-b border-[rgb(var(--color-border))] flex items-center justify-between px-4 shadow-sm bg-[rgb(var(--color-surface))] z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[fe&&e.jsx("button",{onClick:()=>M("channels"),children:e.jsx(ms,{size:24})}),e.jsx(Oe,{size:24,className:"text-[rgb(var(--color-text-secondary))]"}),e.jsx("span",{className:"font-bold",children:l.name})]}),e.jsxs("div",{className:"flex gap-4 text-[rgb(var(--color-text-secondary))]",children:[e.jsx("button",{onClick:()=>{Ve(!0),Mr()},className:"hover:text-[rgb(var(--color-text))]",title:"Channel Media",children:e.jsx(hr,{size:24})}),e.jsx("button",{onClick:()=>le(!ne),className:`${ne?"text-[rgb(var(--color-text))]":""}`,children:e.jsx(Yr,{size:24})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-1 custom-scrollbar",ref:T,onScroll:Er,children:[F&&e.jsx("div",{className:"text-center text-xs text-[rgb(var(--color-text-secondary))] py-2",children:"Loading more messages..."}),k.map((r,a)=>{const s=k[a-1],n=!s||s.user_id!==r.user_id||new Date(r.created_at).getTime()-new Date(s.created_at).getTime()>3e5,m=!s||new Date(r.created_at).toDateString()!==new Date(s.created_at).toDateString(),h=r.user_id===d?.id;return e.jsxs("div",{children:[m&&e.jsxs("div",{className:"flex items-center my-4 text-[rgb(var(--color-text-secondary))] text-xs font-bold",children:[e.jsx("div",{className:"h-px bg-[rgb(var(--color-border))] flex-1"}),e.jsx("span",{className:"px-2",children:Ns(r.created_at)}),e.jsx("div",{className:"h-px bg-[rgb(var(--color-border))] flex-1"})]}),e.jsxs("div",{className:`group flex gap-4 px-2 py-1 rounded hover:bg-[rgb(var(--color-surface-hover))] ${n?"mt-3":""}`,children:[n?e.jsxs("div",{className:"relative mt-0.5 w-10 h-10 flex-shrink-0",children:[e.jsx("img",{src:r.sender?.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${r.sender?.username}`,className:"w-10 h-10 rounded-full cursor-pointer hover:opacity-80 object-cover",onClick:()=>I(r.sender||null)}),ze(r.sender?.last_seen)&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 border-2 border-[rgb(var(--color-surface))] rounded-full z-10"})]}):e.jsx("div",{className:"w-10 text-xs text-[rgb(var(--color-text-secondary))] opacity-0 group-hover:opacity-100 text-right select-none pt-1 flex-shrink-0",children:new Date(r.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}).replace(/\s[AP]M/,"")}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[n&&e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"font-bold hover:underline cursor-pointer text-[rgb(var(--color-text))]",onClick:()=>I(r.sender||null),children:r.sender?.display_name}),e.jsx("span",{className:"text-xs text-[rgb(var(--color-text-secondary))]",children:new Date(r.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),r.reply_to&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[rgb(var(--color-text-secondary))] opacity-80 mb-1 pl-2 border-l-2 border-[rgb(var(--color-border))]",children:[e.jsxs("span",{className:"font-bold",children:["@",r.reply_to.sender?.display_name||"Unknown",":"]}),e.jsx("span",{className:"truncate",children:r.reply_to.content||"[Media]"})]}),v===r.id?e.jsxs("div",{className:"bg-[rgb(var(--color-background))] p-2 rounded border border-[rgb(var(--color-border))]",children:[e.jsx("input",{value:B,onChange:p=>L(p.target.value),className:"w-full bg-transparent outline-none",autoFocus:!0,onKeyDown:p=>{p.key==="Enter"?Vr():p.key==="Escape"&&C(null)}}),e.jsx("div",{className:"text-xs mt-2 text-[rgb(var(--color-text-secondary))]",children:"Enter to save â€¢ Escape to cancel"})]}):e.jsx("div",{className:"text-[rgb(var(--color-text))] whitespace-pre-wrap break-words opacity-90",children:r.content.split(" ").map((p,J)=>p.match(/^https?:\/\//)?e.jsxs("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"text-[rgb(var(--color-primary))] hover:underline break-all",children:[p," "]},J):p+" ")}),r.content&&pr(r.content)&&!r.media_url&&e.jsx(Xr,{url:pr(r.content)}),e.jsxs("div",{className:"absolute -top-4 right-0 bg-[rgb(var(--color-surface))] border border-[rgb(var(--color-border))] rounded shadow-sm hidden group-hover:flex z-10 items-center",children:[e.jsx("button",{onClick:p=>{const J=p.currentTarget.getBoundingClientRect();ye({messageId:r.id,x:J.left,y:J.top})},className:"p-1.5 hover:bg-[rgb(var(--color-surface-hover))] text-[rgb(var(--color-text-secondary))] hover:text-yellow-500 transition",title:"Add Reaction",children:e.jsx(Zr,{size:14})}),e.jsx("button",{onClick:()=>Ee(r),className:"p-1.5 hover:bg-[rgb(var(--color-surface-hover))] text-[rgb(var(--color-text-secondary))]",title:"Reply",children:e.jsx(Qr,{size:14})}),h&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{C(r.id),L(r.content)},className:"p-1.5 hover:bg-[rgb(var(--color-surface-hover))] text-[rgb(var(--color-text-secondary))]",title:"Edit",children:e.jsx(es,{size:14})}),e.jsx("button",{onClick:()=>Lr(r.id),className:"p-1.5 hover:bg-[rgb(var(--color-surface-hover))] text-red-500",title:"Delete",children:e.jsx(ge,{size:14})})]})]}),r.media_url&&e.jsxs("div",{className:"mt-2",children:[r.media_type==="image"&&e.jsx("img",{src:r.media_url,className:"max-h-80 rounded-lg border border-[rgb(var(--color-border))]"}),r.media_type==="video"&&e.jsx("video",{src:r.media_url,controls:!0,className:"max-h-80 rounded-lg border border-[rgb(var(--color-border))]"}),r.media_type==="audio"&&e.jsx("div",{className:"bg-[rgb(var(--color-surface))] p-2 rounded w-64 border border-[rgb(var(--color-border))]",children:e.jsx(Ge,{src:r.media_url,isOutgoing:!1})}),(r.media_type==="document"||!["image","video","audio"].includes(r.media_type||""))&&e.jsxs("a",{href:r.media_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-[rgb(var(--color-surface-hover))] rounded w-fit border border-[rgb(var(--color-border))] hover:bg-[rgb(var(--color-border))] transition",children:[e.jsx(he,{size:16}),e.jsx("span",{className:"truncate max-w-xs",children:r.media_url})]})]}),r.reactions&&r.reactions.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:ws(r.reactions,d?.id||"").map(p=>e.jsxs("div",{onClick:()=>mr(r.id,p.emoji),onContextMenu:J=>{J.preventDefault(),be(r)},className:`
                                                              flex items-center gap-1.5 px-2 py-0.5 rounded-lg border text-xs font-bold cursor-pointer transition select-none
                                                              ${p.hasReacted?"bg-[rgba(var(--color-primary),0.15)] border-[rgba(var(--color-primary),0.5)] text-[rgb(var(--color-primary))]":"bg-[rgb(var(--color-surface))] border-transparent hover:border-[rgb(var(--color-text-secondary))] text-[rgb(var(--color-text-secondary))]"}
                                                          `,title:`${p.senders.join(", ")} reacted`,children:[e.jsx("span",{children:p.emoji}),e.jsx("span",{children:p.count})]},p.emoji))})]})]})]},r.id)}),e.jsx("div",{ref:sr})]}),e.jsx("div",{className:"p-4 pt-0",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface-hover))] rounded-lg p-2 pr-4 shadow-inner relative",children:[Ie&&e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-[rgb(var(--color-border))]",children:e.jsx("div",{className:"h-full bg-[rgb(var(--color-primary))] transition-all duration-300",style:{width:`${Nr}%`}})}),e.jsxs("div",{className:"flex flex-col gap-2 mb-1 pt-2",children:[ae&&e.jsxs("div",{className:"flex items-center justify-between bg-[rgb(var(--color-surface))] p-2 rounded border-l-4 border-[rgb(var(--color-primary))] text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-[rgb(var(--color-primary))] font-bold mr-2",children:["Replying to ",ae.sender?.display_name]}),e.jsx("span",{className:"text-[rgb(var(--color-text-secondary))] truncate block",children:ae.content||"[Media]"})]}),e.jsx("button",{onClick:()=>Ee(null),children:e.jsx(H,{size:16})})]}),_r==="url"&&!q&&!V&&e.jsxs("div",{className:"flex items-center gap-2 bg-[rgb(var(--color-surface))] p-2 rounded border border-[rgb(var(--color-border))]",children:[e.jsx(he,{size:16,className:"text-[rgb(var(--color-text-secondary))]"}),e.jsx("input",{autoFocus:!0,className:"flex-1 bg-transparent outline-none text-sm",placeholder:"Paste media URL here...",value:V,onChange:r=>pe(r.target.value)}),e.jsx("button",{onClick:()=>Re(null),className:"p-1 hover:bg-[rgb(var(--color-surface-hover))] rounded",children:e.jsx(H,{size:14})})]}),gr()&&e.jsxs("div",{className:"flex items-center justify-between bg-[rgb(var(--color-surface))] p-2 rounded border border-[rgb(var(--color-border))]",children:[gr(),e.jsx("button",{onClick:()=>{ue(null),pe("")},className:"p-1 hover:bg-[rgb(var(--color-surface-hover))] rounded",children:e.jsx(H,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Ke(!We),className:"p-2 text-[rgb(var(--color-text-secondary))] hover:text-[rgb(var(--color-text))] rounded-full relative",children:[e.jsx(ke,{size:20,className:"bg-[rgb(var(--color-text-secondary))] text-[rgb(var(--color-surface))] rounded-full p-0.5"}),We&&e.jsxs("div",{className:"absolute bottom-10 left-0 bg-[rgb(var(--color-surface))] border border-[rgb(var(--color-border))] rounded shadow-lg flex flex-col p-2 w-40 z-20",children:[e.jsxs("button",{onClick:()=>tr.current?.click(),className:"flex items-center gap-2 p-2 hover:bg-[rgb(var(--color-surface-hover))] rounded text-sm",children:[e.jsx(Ae,{size:16})," Upload File"]}),e.jsxs("button",{onClick:()=>{Re("url"),Ke(!1)},className:"flex items-center gap-2 p-2 hover:bg-[rgb(var(--color-surface-hover))] rounded text-sm",children:[e.jsx(he,{size:16})," Paste URL"]})]})]}),e.jsx("input",{className:"flex-1 bg-transparent outline-none py-2 max-h-32 overflow-y-auto text-[rgb(var(--color-text))]",placeholder:`Message #${l.name}`,value:de,onChange:r=>Je(r.target.value),onPaste:Fr,onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&br(r)}}),e.jsx("input",{type:"file",ref:tr,className:"hidden",onChange:r=>{r.target.files?.[0]&&ue(r.target.files[0])}}),de||q||V?e.jsx("button",{onClick:br,disabled:Ie,className:"p-2 text-[rgb(var(--color-primary))]",children:e.jsx(rs,{size:20})}):e.jsx("button",{onClick:Ye?Ar:Pr,className:`p-2 ${Ye?"text-red-500 animate-pulse":"text-[rgb(var(--color-text-secondary))]"}`,children:e.jsx(Ce,{size:20})})]})]})})]}):e.jsxs("div",{className:"flex-1 flex items-center justify-center text-[rgb(var(--color-text-secondary))] flex-col p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[rgb(var(--color-surface))] rounded-full flex items-center justify-center mb-4",children:e.jsx(Oe,{size:32})}),e.jsx("h3",{className:"text-lg font-bold",children:"No Channel Selected"}),e.jsx("p",{children:"Select a text channel from the sidebar to start chatting."})]})}),ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:flex w-60 bg-[rgb(var(--color-surface))] border-l border-[rgb(var(--color-border))] flex-col p-4 overflow-y-auto",children:lr()}),e.jsx("div",{className:"md:hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-sm flex justify-end transition-opacity",onClick:()=>le(!1),children:e.jsxs("div",{className:"w-72 h-full bg-[rgb(var(--color-surface))] shadow-2xl border-l border-[rgb(var(--color-border))] flex flex-col transform transition-transform duration-300 ease-in-out",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-[rgb(var(--color-border))] flex justify-between items-center bg-[rgb(var(--color-surface))]",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Members"}),e.jsx("button",{onClick:()=>le(!1),className:"p-1 rounded-full hover:bg-[rgb(var(--color-surface-hover))]",children:e.jsx(H,{size:24})})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1 custom-scrollbar bg-[rgb(var(--color-background))]",children:lr()})]})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[60] backdrop-blur-sm",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] p-8 rounded-2xl w-full max-w-md shadow-2xl border border-[rgb(var(--color-border))] text-center transform transition-all animate-in fade-in zoom-in duration-300",children:[e.jsx("div",{className:"w-24 h-24 rounded-3xl mx-auto mb-4 overflow-hidden shadow-lg relative group",children:t.gazebo.icon_url?e.jsx("img",{src:t.gazebo.icon_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-[rgb(var(--color-primary))] flex items-center justify-center text-3xl font-bold text-white",children:t.gazebo.name.substring(0,2).toUpperCase()})}),e.jsx("h2",{className:"text-2xl font-black mb-1",children:t.gazebo.name}),e.jsx("p",{className:"text-[rgb(var(--color-text-secondary))] mb-6 text-sm",children:"Welcome to the server!"}),e.jsxs("div",{className:"bg-[rgb(var(--color-surface-hover))] rounded-xl p-4 mb-6 text-left flex items-center gap-4",children:[e.jsx("img",{src:t.owner.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.owner.username}`,className:"w-12 h-12 rounded-full border-2 border-[rgb(var(--color-surface))]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold uppercase text-[rgb(var(--color-text-secondary))] mb-0.5",children:"Created By"}),e.jsxs("div",{className:"font-bold flex items-center gap-1",children:[t.owner.display_name,t.owner.verified&&e.jsx(ss,{size:14,className:"text-[rgb(var(--color-accent))]"})]}),e.jsxs("div",{className:"text-xs opacity-70",children:["@",t.owner.username]})]})]}),e.jsx("button",{onClick:()=>u(null),className:"w-full py-3 bg-[rgb(var(--color-primary))] text-white rounded-xl font-bold hover:opacity-90 transition shadow-lg shadow-[rgb(var(--color-primary))]/20",children:"Enter Server"})]})}),Me&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] p-8 rounded-xl w-full max-w-md shadow-2xl border border-[rgb(var(--color-border))] text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Create a server"}),e.jsx("p",{className:"text-[rgb(var(--color-text-secondary))] mb-6",children:"Your server is where you and your friends hang out. Make yours and start talking."}),e.jsxs("button",{onClick:()=>{U(!1),ie(!0)},className:"w-full flex items-center justify-between p-4 mb-2 border border-[rgb(var(--color-border))] rounded-lg hover:bg-[rgb(var(--color-surface-hover))] transition text-left group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/2921/2921222.png",className:"w-10 h-10 opacity-70 group-hover:opacity-100 transition",alt:"Create"}),e.jsx("span",{className:"font-bold",children:"Create My Own"})]}),e.jsx(Ue,{className:"-rotate-90 text-[rgb(var(--color-text-secondary))]"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-bold text-[rgb(var(--color-text-secondary))] mb-2",children:"Have an invite already?"}),e.jsx("button",{onClick:()=>{U(!1),te(!0)},className:"w-full bg-[rgb(var(--color-surface-hover))] py-2 rounded-lg font-medium hover:bg-[rgb(var(--color-border))] transition",children:"Join a Server"})]}),e.jsx("button",{onClick:()=>U(!1),className:"mt-6 text-sm text-[rgb(var(--color-text-secondary))] hover:underline",children:"Close"})]})}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] p-6 rounded-lg w-full max-w-md shadow-xl border border-[rgb(var(--color-border))]",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-green-500 mb-2",children:"Join a Server"}),e.jsx("p",{className:"text-[rgb(var(--color-text-secondary))] text-sm",children:"Enter an invite code below to join an existing server."})]}),e.jsx("input",{id:"inviteInput",className:"w-full p-2 bg-[rgb(var(--color-background))] border border-[rgb(var(--color-border))] rounded mb-4",placeholder:"Invite Code (e.g. XyZ123)"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>{te(!1),U(!0)},className:"text-sm hover:underline",children:"Back"}),e.jsx("button",{onClick:()=>ur(document.getElementById("inviteInput").value),className:"bg-green-500 text-white px-6 py-2 rounded font-bold hover:bg-green-600",children:"Join Server"})]})]})}),se&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] p-6 rounded-lg w-96 shadow-xl border border-[rgb(var(--color-border))]",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Customize Your Server"}),e.jsx("p",{className:"text-center text-[rgb(var(--color-text-secondary))] text-sm mb-6",children:"Give your new server a personality with a name and an icon."}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"w-24 h-24 rounded-full border-2 border-dashed border-[rgb(var(--color-border))] flex items-center justify-center relative overflow-hidden group cursor-pointer",children:[Te?e.jsx("img",{src:Te,className:"w-full h-full object-cover"}):e.jsx(Ae,{className:"text-[rgb(var(--color-text-secondary))]"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:r=>dr(r,"create")}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition text-xs text-white font-bold",children:"UPLOAD"})]})}),e.jsx("input",{id:"newGazeboName",type:"text",placeholder:"Server Name",className:"w-full p-2 bg-[rgb(var(--color-background))] border border-[rgb(var(--color-border))] rounded mb-4 text-[rgb(var(--color-text))]"}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx("button",{onClick:()=>{ie(!1),U(!0)},className:"text-[rgb(var(--color-text-secondary))] hover:underline",children:"Back"}),e.jsx("button",{onClick:()=>Ir(document.getElementById("newGazeboName").value),className:"px-6 py-2 bg-[rgb(var(--color-primary))] text-white rounded font-bold",children:"Create"})]})]})}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] p-6 rounded-lg w-96 shadow-xl border border-[rgb(var(--color-border))]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Create Channel"}),e.jsx("button",{onClick:()=>Y(!1),children:e.jsx(H,{size:20,className:"text-[rgb(var(--color-text-secondary))]"})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-[rgb(var(--color-text-secondary))] mb-2",children:"Channel Name"}),e.jsx("input",{id:"newChannelName",placeholder:"new-channel",className:"w-full p-2 bg-[rgb(var(--color-background))] border border-[rgb(var(--color-border))] rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-[rgb(var(--color-text-secondary))] mb-2",children:"Channel Type"}),e.jsxs("select",{id:"newChannelType",className:"w-full p-2 bg-[rgb(var(--color-background))] border border-[rgb(var(--color-border))] rounded",children:[e.jsx("option",{value:"text",children:"Text Channel"}),e.jsx("option",{value:"voice",children:"Voice Channel"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Y(!1),className:"px-4 py-2 text-[rgb(var(--color-text-secondary))] hover:underline",children:"Cancel"}),e.jsx("button",{onClick:()=>qe("create",{name:document.getElementById("newChannelName").value.toLowerCase().replace(/\s/g,"-"),type:document.getElementById("newChannelType").value}),className:"px-6 py-2 bg-[rgb(var(--color-primary))] text-white rounded",children:"Create"})]})]})}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] p-6 rounded-lg w-full max-w-md shadow-xl border border-[rgb(var(--color-border))] max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between mb-6 border-b border-[rgb(var(--color-border))] pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Server Settings"}),e.jsx("button",{onClick:()=>ce(!1),children:e.jsx(H,{})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"font-bold mb-2 uppercase text-xs text-[rgb(var(--color-text-secondary))]",children:"Overview"}),e.jsxs("div",{className:"flex gap-4 items-center mb-4",children:[e.jsx("img",{src:x?.icon_url||`https://ui-avatars.com/api/?name=${x?.name}&background=random`,className:"w-24 h-24 rounded-full object-cover border-2 border-[rgb(var(--color-border))]"}),e.jsxs("label",{className:"cursor-pointer text-sm bg-[rgb(var(--color-primary))] text-white px-4 py-2 rounded font-medium hover:opacity-90 transition",children:["Change Icon",e.jsx("input",{type:"file",className:"hidden",onChange:r=>dr(r,"update")})]})]}),e.jsx("input",{type:"text",defaultValue:x?.name,onBlur:r=>xr({name:r.target.value}),className:"w-full p-2 bg-[rgb(var(--color-background))] border border-[rgb(var(--color-border))] rounded"})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"font-bold mb-2 uppercase text-xs text-[rgb(var(--color-text-secondary))]",children:"Invites"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{id:"customCode",placeholder:"Custom Invite Code",className:"flex-1 p-2 bg-[rgb(var(--color-background))] rounded border border-[rgb(var(--color-border))]"}),e.jsx("button",{onClick:()=>fr("create",document.getElementById("customCode").value),className:"bg-[rgb(var(--color-primary))] text-white px-3 rounded",children:"Create"})]}),e.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto custom-scrollbar p-1",children:[Se.map(r=>e.jsxs("div",{className:"flex justify-between items-center bg-[rgb(var(--color-surface-hover))] p-2 rounded text-sm border border-[rgb(var(--color-border))]",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-mono font-bold text-[rgb(var(--color-primary))]",children:r.invite_code}),e.jsxs("span",{className:"text-[10px] text-[rgb(var(--color-text-secondary))]",children:[r.uses_count," uses"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/invite/${r.invite_code}`),alert("Copied!")},className:"p-1 hover:bg-[rgb(var(--color-background))] rounded",children:e.jsx(us,{size:14})}),e.jsx("button",{onClick:()=>fr("delete",r.id),className:"text-red-500 p-1 hover:bg-[rgb(var(--color-background))] rounded",children:e.jsx(ge,{size:14})})]})]},r.id)),e.jsx("button",{onClick:async()=>{const{data:r}=await b.from("gazebo_invites").select("*").eq("gazebo_id",x.id);Q(r||[])},className:"text-xs underline text-[rgb(var(--color-text-secondary))] mt-2",children:"Load Existing Invites"})]})]}),me&&e.jsxs("section",{className:"pt-4 border-t border-[rgb(var(--color-border))]",children:[e.jsx("h3",{className:"font-bold mb-2 uppercase text-xs text-red-500",children:"Danger Zone"}),e.jsxs("button",{onClick:Dr,className:"flex items-center justify-between gap-2 text-red-500 border border-red-500 hover:bg-red-500 hover:text-white w-full p-2 rounded transition",children:[e.jsx("span",{children:"Delete Server"}),e.jsx(ge,{size:18})]})]})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>I(null),children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] w-80 rounded-xl shadow-2xl overflow-hidden border border-[rgb(var(--color-border))]",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"h-24 bg-[rgb(var(--color-primary))] relative",children:[$.banner_url&&e.jsx("img",{src:$.banner_url,className:"w-full h-full object-cover"}),e.jsx("img",{src:$.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${$.username}`,className:"w-20 h-20 rounded-full border-4 border-[rgb(var(--color-surface))] absolute -bottom-10 left-4 bg-[rgb(var(--color-surface))]"})]}),e.jsxs("div",{className:"pt-12 pb-4 px-4",children:[e.jsxs("div",{className:"font-bold text-xl flex items-center gap-1",children:[$.display_name,ze($.last_seen)&&e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full ml-1",title:"Online"})]}),e.jsxs("div",{className:"text-[rgb(var(--color-text-secondary))] text-sm",children:["@",$.username]}),e.jsx("div",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-4 mt-0.5",children:ze($.last_seen)?"Online":ys($.last_seen)}),e.jsxs("div",{className:"border-t border-[rgb(var(--color-border))] py-2 mb-2",children:[e.jsx("h4",{className:"text-xs font-bold uppercase text-[rgb(var(--color-text-secondary))] mb-1",children:"About Me"}),e.jsx("p",{className:"text-sm",children:$.bio||"No bio set."})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{window.location.href=`/message?user=${$.username}`},className:"flex-1 bg-[rgb(var(--color-primary))] text-white py-2 rounded font-medium text-sm",children:"Message"}),e.jsx("button",{onClick:()=>{I(null),R(`/?user=${$.username}`)},className:"flex-1 bg-[rgb(var(--color-surface-hover))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text))] py-2 rounded font-medium text-sm",children:"View Profile"})]})]})]})}),je&&e.jsx("div",{className:"fixed inset-0 z-[100]",onClick:()=>ye(null),onContextMenu:r=>{r.preventDefault(),ye(null)},children:e.jsx("div",{className:"absolute p-2 bg-[rgb(var(--color-surface))] rounded-xl shadow-2xl flex gap-1 z-50 pointer-events-auto border border-[rgb(var(--color-border))] animate-in zoom-in-95 duration-100",style:{top:je.y-50,left:je.x},onClick:r=>r.stopPropagation(),children:js.map(r=>e.jsx("button",{onClick:()=>mr(je.messageId,r),className:"text-2xl p-2 rounded-lg hover:bg-[rgb(var(--color-surface-hover))] transition hover:scale-110 active:scale-95",children:r},r))})}),we&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:()=>be(null),children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] w-full max-w-sm rounded-xl shadow-2xl overflow-hidden border border-[rgb(var(--color-border))]",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-[rgb(var(--color-border))] flex justify-between items-center bg-[rgb(var(--color-surface-hover))]",children:[e.jsx("h3",{className:"font-bold text-[rgb(var(--color-text))]",children:"Reactions"}),e.jsx("button",{onClick:()=>be(null),className:"p-1 hover:bg-[rgb(var(--color-background))] rounded-full",children:e.jsx(H,{size:18})})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto p-2",children:[we.reactions?.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-[rgb(var(--color-surface-hover))] rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.profiles.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${r.profiles.username}`,className:"w-8 h-8 rounded-full"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 text-sm",children:r.emoji})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm",children:r.profiles.display_name}),e.jsxs("div",{className:"text-xs text-[rgb(var(--color-text-secondary))]",children:["@",r.profiles.username]})]})]}),r.user_id===d?.id&&e.jsx("button",{onClick:()=>qr(r.id),className:"text-[rgb(var(--color-text-secondary))] hover:text-red-500 p-2 opacity-0 group-hover:opacity-100 transition",children:e.jsx(ge,{size:14})})]},r.id)),(!we.reactions||we.reactions.length===0)&&e.jsx("div",{className:"text-center p-4 text-[rgb(var(--color-text-secondary))]",children:"No reactions yet"})]})]})}),zr&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:()=>Ve(!1),children:e.jsxs("div",{className:"bg-[rgb(var(--color-surface))] w-full max-w-4xl h-[85vh] rounded-2xl shadow-2xl overflow-hidden border border-[rgb(var(--color-border))] flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-[rgb(var(--color-border))] flex justify-between items-center bg-[rgb(var(--color-surface))]",children:[e.jsx("h3",{className:"font-bold text-xl text-[rgb(var(--color-text))]",children:"Channel Media"}),e.jsx("button",{onClick:()=>Ve(!1),className:"p-2 rounded-full hover:bg-[rgb(var(--color-surface-hover))] text-[rgb(var(--color-text-secondary))]",children:e.jsx(H,{size:24})})]}),e.jsxs("div",{className:"flex border-b border-[rgb(var(--color-border))] bg-[rgb(var(--color-surface))]",children:[e.jsxs("button",{onClick:()=>Ne("image"),className:`flex-1 py-3 font-semibold flex items-center justify-center gap-2 transition ${D==="image"?"text-[rgb(var(--color-accent))] border-b-2 border-[rgb(var(--color-accent))]":"text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-surface-hover))]"}`,children:[e.jsx(Ae,{size:18})," Images"]}),e.jsxs("button",{onClick:()=>Ne("video"),className:`flex-1 py-3 font-semibold flex items-center justify-center gap-2 transition ${D==="video"?"text-[rgb(var(--color-accent))] border-b-2 border-[rgb(var(--color-accent))]":"text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-surface-hover))]"}`,children:[e.jsx(ts,{size:18})," Videos"]}),e.jsxs("button",{onClick:()=>Ne("audio"),className:`flex-1 py-3 font-semibold flex items-center justify-center gap-2 transition ${D==="audio"?"text-[rgb(var(--color-accent))] border-b-2 border-[rgb(var(--color-accent))]":"text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-surface-hover))]"}`,children:[e.jsx(as,{size:18})," Audio"]}),e.jsxs("button",{onClick:()=>Ne("document"),className:`flex-1 py-3 font-semibold flex items-center justify-center gap-2 transition ${D==="document"?"text-[rgb(var(--color-accent))] border-b-2 border-[rgb(var(--color-accent))]":"text-[rgb(var(--color-text-secondary))] hover:bg-[rgb(var(--color-surface-hover))]"}`,children:[e.jsx(Fe,{size:18})," Files"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-[rgb(var(--color-background))]",children:Sr?e.jsx("div",{className:"flex h-full items-center justify-center text-[rgb(var(--color-text-secondary))]",children:"Loading media..."}):e.jsx(e.Fragment,{children:_e.filter(r=>r.media_type===D).length===0?e.jsxs("div",{className:"flex h-full items-center justify-center text-[rgb(var(--color-text-secondary))] flex-col gap-2",children:[e.jsx(hr,{size:48,className:"opacity-20"}),e.jsxs("span",{children:["No ",D,"s found"]})]}):e.jsxs(e.Fragment,{children:[(D==="image"||D==="video")&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:_e.filter(r=>r.media_type===D).map(r=>e.jsxs("div",{className:"aspect-square relative group bg-[rgb(var(--color-surface))] rounded overflow-hidden",children:[D==="image"?e.jsx("a",{href:r.media_url,target:"_blank",rel:"noopener noreferrer",className:"block w-full h-full",children:e.jsx("img",{src:r.media_url,className:"w-full h-full object-cover hover:opacity-90 transition",alt:"Shared"})}):e.jsx("video",{src:r.media_url,className:"w-full h-full object-cover",controls:!0}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition p-2 pointer-events-none",children:[e.jsxs("div",{className:"text-[10px] text-white truncate",children:["Sent by ",r.sender?.display_name]}),e.jsx("div",{className:"text-[10px] text-gray-300",children:new Date(r.created_at).toLocaleDateString()})]})]},r.id))}),D==="audio"&&e.jsx("div",{className:"space-y-3",children:_e.filter(r=>r.media_type===D).map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-[rgb(var(--color-surface))] rounded-xl border border-[rgb(var(--color-border))]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[rgba(var(--color-accent),0.1)] flex items-center justify-center flex-shrink-0 text-[rgb(var(--color-accent))]",children:e.jsx(Ce,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsxs("span",{className:"text-xs text-[rgb(var(--color-text-secondary))]",children:[r.sender?.display_name," â€¢ ",new Date(r.created_at).toLocaleString()]})}),e.jsx(Ge,{src:r.media_url,isOutgoing:!1})]})]},r.id))}),D==="document"&&e.jsx("div",{className:"space-y-2",children:_e.filter(r=>r.media_type===D).map(r=>e.jsxs("a",{href:r.media_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 bg-[rgb(var(--color-surface))] rounded-xl border border-[rgb(var(--color-border))] hover:bg-[rgb(var(--color-surface-hover))] transition group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[rgba(var(--color-primary),0.1)] flex items-center justify-center flex-shrink-0 text-[rgb(var(--color-primary))]",children:e.jsx(Fe,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-[rgb(var(--color-text))] truncate",children:r.content||$r(r.media_url.split("/").pop()||"Unknown File",30)}),e.jsxs("p",{className:"text-xs text-[rgb(var(--color-text-secondary))]",children:[new Date(r.created_at).toLocaleDateString()," â€¢ Sent by ",r.sender?.display_name]})]}),e.jsx("div",{className:"p-2 text-[rgb(var(--color-text-secondary))] group-hover:text-[rgb(var(--color-accent))]",children:e.jsx(he,{size:18})})]},r.id))})]})})})]})}),xe&&d&&e.jsx(ps,{channelId:xe.channelId,channelName:xe.name,user:d,onDisconnect:()=>{Qe(null),rr(!1)},isMinimized:er,onToggleMinimize:()=>rr(!er)})]})};export{Cs as Gazebos};
